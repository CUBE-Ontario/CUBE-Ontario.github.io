---
title: "COVID-19 in the Urban Built Environment"
output: 
  html_document:
    toc: true
    toc_float:
      toc_collapsed: false
    toc_depth: 2
---

<!-- ADDING NEW INFO to website: (how-to)-->

<!-- Site: add a line to the data/sites.tsv file; don't include loction name; copy the coordinates from a location in the same city; add the type of facility; use tabs to seperate fields -->

<!-- Team Member: Add their photo to pics/; write a tab-delimited line in data/team_profiles.tsv with name, the picture filename, and bio text  -->
<!-- name <tab> pic_filename.jpg <tab> bio paragraph -->

<!-- FAQ: add comma-delimited line to data/FAQs.csv with: "question", "answer" -->



<h5 class='subtitle'>Developing environmental sampling as a method for monitoring SARS-CoV-2 in congregate settings</h2>
<hr>

```{r setup, include=F}
knitr::opts_chunk$set(
  message = FALSE, warning = FALSE, echo = FALSE,
  comment = "#>",
  fig.path = "figures", # use only for single Rmd files
  collapse = TRUE
)
```

```{r}
library(tidyverse)
library(leaflet)
library(htmltools)
library(metathis)
library(glue)
library(fontawesome)
```




```{r meta, results='asis'}
# <meta> tags to add to <head>
# these are various tags that provide info about our site
description_text <- "The COVID-19 in the Urban Built Environment (CUBE) project seeks to develop environmental sampling as a spatially-resolved method for monitoring COVID-19 in congregate settings such as long-term care homes (LTC), universities, public schools, and daycares. "
meta() |> 
  meta_viewport() |> 
  # keep this meta tag for google search indexing
  meta_name("google-site-verification" = "2hjin2NTF-SVY6SAw-HRZcg1Z-q5iNEbwHOTW4yfIao") |> 
  meta_general(
    application_name = 'COVID-19 in the Urban Built Environment',
    description = description_text,
    robots = 'index',
    subject = "COVID-19 SARS-CoV-2 environmental microbiology epidemiology urban built environment Ontario",
    rating = "General"
  ) |>
  meta_social(
    title = "COVID-19 in the Urban Built Environment",
    url = "https://cube-ontario.github.io",
    image = "https://cube-ontario.github.io/figures/CUBE_info6.png",
    image_alt = description_text,
    og_type = "website",
    og_site_name = "COVID-19 in the Urban Built Environment",
    og_author = c("Lucas Castellani","Evgueni Doukhanine", "Michael Fralick", "Aaron Hinz", "Benazir Hodzic-Santor", "Rees Kassen", "Derek MacFadden", "Allison McGeer","Jason Moggridge", "Caroline Nott", "Ashley Raudanskis", "Nisha Thampi", "Tamara Van Bakel", "Alex Wong", "Veronica Zanichelli"),
    twitter_card_type = "summary_large_image",
    twitter_creator = "@quaxlikeaduck",
    twitter_site = "@quaxlikeaduck",
    # twitter_image = "https://cube-ontario.github.io/figures/CUBE_info6.png",
    disable_pinterest = TRUE
  )

```

```{r icons}
email_icon <- icons::icon_style(icons::fontawesome("paper-plane", style = "solid"), fill = '#2469e0', hover = '#fff')
```



<br>
<!-- ## About CUBE section-->
<div class='card'>
  <!-- header -->
  <h2> About the CUBE study</h2>
  <hr>
  <!-- *--infographic here--* -->
  <img class='info' src="figures/CUBE_info6.png" 
      alt="CUBE Study Infographic: 
      [Panel 1] Setting: CUBE monitors COVID-19 in congregate settings such as long-term care homes, schools, and daycares. Study sites are tested on a weekly or biweekly basis. 
      [Panel 2] Sampling: We collect samples by swabbing a small area of the floor. We also measure the CO2 concentration of the air. Multiple samples are collected from each facility.
      [Panel 3]: Testing: We use a PCR test to determine which samples contain SARS-CoV2. We are also testing a CRISPR-based method and other approaches.">
  <ul>
  <hr>
  <!-- blurb -->
   <li>
   The COVID-19 in the Urban Built Environment (CUBE) project seeks to develop environmental sampling as a spatially-resolved method for monitoring COVID-19 in congregate settings such as long-term care homes (LTC), universities, public schools, and daycares. 
   </li>
   <li>
   We collect samples by swabbing floors; then, the swabs are tested for COVID-19 using an [RT-qPCR](https://en.wikipedia.org/wiki/Reverse_transcription_polymerase_chain_reaction) assay developed by [DNA Genotek](https://www.dnagenotek.com/) and/or a novel CRISPR-based device.
  </li>
  <li>
  Currently, we are focused on facilities located in Toronto, Ottawa, and Sault Ste. Marie.
  </li>
  <li>
  [Click here to read our preprint](https://www.medrxiv.org/content/10.1101/2021.04.09.21255159v2) from an earlier study showing the effectiveness of environmental sampling for COVID-19 monitoring.
  </li>
  </ul>
</div>
<br>


<div class='card'>
  <h2>We're hiring!</h2>
  <p>We're looking for a junior technician to help us detect SARS-CoV-2 from environmental samples. [Click here for more details](./job_posting.html)</p>
</div>
<br>

<!-- SITES MAP SECTION -->

```{r message=FALSE, warning=FALSE}
# read site geo data and set marker colors based on type of site
sites <- 
  read_tsv(file = 'data/sites.tsv') 
n_site <- sites |> nrow()
# values to output in map description text
n_ltc <- sites |> filter(type =="LTC") |> nrow()
n_dc <- sites |> filter(type == 'Daycare') |> nrow()
n_uni <- sites |> filter(type == 'University') |> nrow()
n_uni <- glue("{n_uni} {ifelse(n_uni >1, 'universities', 'university')}")
```

<div class='card'>
  <h2>Study Locations</h2>
  <hr>
  <!-- map description -->
  <!-- dynamic text with values based on the data in sites.tsv -->
  <p>
  Our research team is currently monitoring `r n_site` buildings in Toronto, Ottawa, and Sault Ste. Marie, including `r n_ltc` long-term care homes, `r n_dc` daycares, and 1 university (6 buildings). Click any city to expand.
  </p>


```{r maps, message=F, warning=FALSE, echo=F, fig.height=3, fig.width=3, fig.align='center'}

# read site geo data and set marker colors based on type of site
sites <- 
  read_tsv(file = 'data/sites.tsv') |> 
  mutate(
    color = case_when(
      type == 'LTC' ~ 'cadetblue',
      type == 'University' ~ 'purple',
      type == 'Daycare' ~ 'green',
      type == 'School' ~ 'orange',
      TRUE ~ 'red'
    ))
# Possible values are "red", "darkred", "lightred", "orange", "beige", "green", "darkgreen", "lightgreen", "blue", "darkblue", "lightblue", "purple", "darkpurple", "pink", "cadetblue", "white", "gray", "lightgray", "black"

# define Marker style: white cube logo on coloured background
icons <- awesomeIcons(
  icon = 'cube',
  library = 'ion',
  iconColor = 'white',
  spin = F,
  markerColor = sites$color
)

# set zoom level for locking map
zmlvl <- 6

ontario_map <-
  # leaflet map; size on page
  leaflet::leaflet(
    width = '95%', 
    height = 300, 
    padding = '5px', 
    options = leafletOptions(zoomControl = FALSE)
  ) |>
  # set the zoom to ~province level
  setView(lng = -80, lat = 45, zoom = zmlvl)  |>
  # add the grey-shaded map tiles from cartoDB
  addProviderTiles(
    provider = providers$CartoDB.Positron, 
    # disable the zoom controls
    options = providerTileOptions(
      zoomControl = FALSE,
      dragging = FALSE,
      maxZoom = zmlvl, 
      minZoom = zmlvl)
  ) |>
  # add the custom cube markers we defined above
  addAwesomeMarkers(
    data = sites,
    lng = ~ lon,
    lat = ~ lat,
    icon = icons,
    label = ~type,
    popup = NULL,
    clusterOptions = markerClusterOptions(freezeAtZoom = zmlvl)
  )

# display the map
ontario_map
```

</div>
<br>


<!-- "Learn more" section -->
<!-- Library of congress lecture card -->

<div class='card' style="width=100% padding=2em">
  <h2 class="cardtitle">Learn More</h2>
  <hr>
  <a href="https://www.loc.gov/item/webcast-9908/">
  <div class="videocard">
  <IMG class="centered_img" src="pics/loc_thumb2.jpg" alt="Library of Congress lecture preview image">
  <h4 style="color: #2c3e50">U.S. Library of Congress COVID19 Webinar Lecture</h4>
  <h5 style="color: #2c3e50">Presented by Rees Kassen and Caroline Nott</h5>
  <i class="fas fa-play"></i>  &nbsp;&nbsp; <em>Skip to 44:10</em>
  </div>
  </a>
  <br>
</div>
<br>


<!-- FAQs card -->
<div class='card'>
<h2>Frequently Asked Questions</h2>
<hr>
<!-- class: "accordion" is the container for the question (button) -->
<!-- class: "panel" is the answer that is revealed on click -->

<!-- Example: -->
<!-- <button class="accordion"> Question </button> -->
<!-- <div class="panel"> <p> Answer </p> </div> -->

```{r results='asis'}
# generates the html for a given faq + answer pair 
make_faq <- function(question, answer){
  cat(glue(
    '<button class="accordion">
      <h4 class="faq">{question}</h4>
    </button>
    <div class="panel">
      <p class="faqans">{answer}<p/>
    </div>'
  ))
}
# FAQs are stored in ./data/
faqs <- read_csv('data/FAQs.csv') |> 
  mutate(html = map2(question, answer, .f = ~make_faq(.x, .y)))
```


<!-- this javascript is needed to observe click/hover events for highlighting and expanding the accordion sections -->
<script>
var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
  acc[i].addEventListener("click", function() {
    <!-- Toggle between adding and removing the "active" class, -->
    <!-- to highlight the button that controls the panel  -->
    this.classList.toggle("active");
    <!-- Toggle between hiding and showing the active panel  -->
    var panel = this.nextElementSibling;
    if (panel.style.display === "none") {
      panel.style.display = "block";
    } else {
      panel.style.display = "none";
    }
  });
}
</script>

<div></div>
</div>
<br>

<!-- CUBE @ Your Facility -->
<div class='card'>
  <h2>CUBE @ Your Facility</h2>
  To arrange for CUBE testing in your facility, 
  [please contact us](./contact.html).
</div>
<br>

<!-- Contribute to CUBE -->
<div class = 'card'>
  <h2>Contribute to CUBE</h2>
  <p>
  If you are interested in contributing to the CUBE research project, 
  [please contact us ](./contact.html) .
  </p>
</div>
<br>
  
  
  <!-- Research team section -->
<div class='card' style="background-color: white">
  <h2>Research Team </h2>
  <hr>

```{r results='asis'}
# use results='asis' for this chunk to return as raw html

# this function generates the html for a single person's profile
make_bio <- function(name, photo, bio){
  photo <- glue('./pics/{photo}')
  html_str <- glue('<div class="row team-profile">
         <p>
            <img class="profilepic" src="{photo}" alt="{name}"> 
            <h4>{name}</h4>
            {bio}
        </p>
      </div>') 
  cat(html_str)
}

# read profiles data and map to html; 
team <- read_tsv('data/team_profiles.tsv') |> 
  mutate(html = pmap(.l = list(name, path_to_pic, bio), .f = function(x,y,z) make_bio(x, y, z)))
```
<br>
</div>

<br>

-----

<h4 style="text-align: center;">[Back to top](#) </h4>

----


<!-- use this line to prevent the floating TOC from adding tons of blank space to the bottom of the webpage -->
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>



