---
title: "COVID-19 in the Urban Built Environment"
output: 
  html_document:
    toc: true
    toc_float:
      toc_collapsed: false
    toc_depth: 4
---

<!-- ADDING NEW INFO to website: (how-to)-->

<!-- Site: add a line to the data/sites.tsv file; don't include loction name; copy the coordinates from a location in the same city; add the type of facility; use tabs to seperate fields -->

<!-- Team Member: Add their photo to pics/; write a tab-delimited line in data/team_profiles.tsv with name, the picture filename, and bio text  -->
<!-- name <tab> pic_filename.jpg <tab> bio paragraph -->

<!-- FAQ: add comma-delimited line to data/FAQs.csv with: "question", "answer" -->


<h5 class='subtitle'>Developing environmental sampling as a method for monitoring SARS-CoV-2 in congregate settings</h2>
<hr>

```{r setup, include=F}
knitr::opts_chunk$set(
  message = FALSE, warning = FALSE, echo = FALSE,
  comment = "#>",
  fig.path = "figures", # use only for single Rmd files
  collapse = TRUE
)
```

```{r libraries}
library(tidyverse)
library(leaflet)
library(htmltools)
library(metathis)
library(glue)
library(fontawesome)
```


```{r card_fx}
make_faq_bootstrap <- function(question, answer, x){
  cat(glue(
    '<div class="card" style="padding: 0px; margin: 10px;">
    <div class="card-header" id="heading_{x}" style="padding: 1px; margin: 0px">
      <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_{x}" aria-expanded="true" aria-controls="collapse_{x}" style="margin: 0px; padding: 1px"><p style="margin: 0px; padding: 10px 8px"><strong>{question}</strong></p></button>
    </div>

    <div id="collapse_{x}" class="collapse hide" aria-labelledby="heading_{x}" data-parent="#accordion" style="padding: 1px">
    <div class="card-body" style="padding: 10px 5px">
      {answer}
    </div>
    </div>
    </div>'
  ))
}

# this function generates the html for a single person's profile
make_bio_bootstrap4 <- function(name, photo, bio){
  photo <- glue('./pics/{photo}')
  html_str <- glue(
    '<div class="card mb-3" style="min-height: 8rem; padding: 1rem 1rem 1rem 1rem; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
      <div class="row no-gutters">
      <div class="col-md-2" style="margin: auto; padding: auto; ">
      <img src="{photo}" class="card-img" alt="profile photo for {name}"
      style="border-radius: 50%; height: 130px; width: 130px; object-fit: cover;">
      </div>
      <div class="col-md-10">
      <div class="card-body">
      <h5 class="card-title">{name}</h5>
      <p class="card-text">{bio}</p>
      </div>
      </div>
      </div>
    </div>'
  )
  cat(html_str)
}
```




```{r map creation}
# read site geo data and set marker colors based on type of site
sites <- 
  read_tsv(file = 'data/sites.tsv')  |> 
  mutate(
    color = case_when(
      type == 'LTC' ~ 'cadetblue',
      type == 'University' ~ 'purple',
      type == 'Daycare' ~ 'green',
      type == 'School' ~ 'orange',
      TRUE ~ 'red'
    ))
n_site <- sites |> nrow()
# values to output in map description text
n_ltc <- sites |> filter(type =="LTC") |> nrow()
n_dc <- sites |> filter(type == 'Daycare') |> nrow()
n_uni <- sites |> filter(type == 'University') |> nrow()
n_uni <- glue("{n_uni} {ifelse(n_uni >1, 'universities', 'university')}")

# Possible values are "red", "darkred", "lightred", "orange", "beige", "green", "darkgreen", "lightgreen", "blue", "darkblue", "lightblue", "purple", "darkpurple", "pink", "cadetblue", "white", "gray", "lightgray", "black"

# define Marker style: white cube logo on coloured background
icons <- awesomeIcons(
  icon = 'cube',
  library = 'ion',
  iconColor = 'white',
  spin = F,
  markerColor = sites$color
)

# set zoom level for locking map
zmlvl <- 6

ontario_map <-
  # leaflet map; size on page
  leaflet::leaflet(
    width = '95%', 
    height = 300, 
    padding = '5px', 
    options = leafletOptions(zoomControl = FALSE)
  ) |>
  # set the zoom to ~province level
  setView(lng = -80, lat = 45, zoom = zmlvl)  |>
  # add the grey-shaded map tiles from cartoDB
  addProviderTiles(
    provider = providers$CartoDB.Positron, 
    # disable the zoom controls
    options = providerTileOptions(
      zoomControl = FALSE,
      dragging = FALSE,
      maxZoom = zmlvl, 
      minZoom = zmlvl)
  ) |>
  # add the custom cube markers we defined above
  addAwesomeMarkers(
    data = sites,
    lng = ~ lon,
    lat = ~ lat,
    icon = icons,
    label = ~type,
    popup = NULL,
    clusterOptions = markerClusterOptions(freezeAtZoom = zmlvl)
  )

```


```{r meta, results='asis'}
# <meta> tags to add to <head>
# these are various tags that provide info about our site
description_text <- "The COVID-19 in the Urban Built Environment (CUBE) project seeks to develop environmental sampling as a spatially-resolved method for monitoring COVID-19 in congregate settings such as long-term care homes (LTC), universities, public schools, and daycares. "
meta() |> 
  meta_viewport() |> 
  # keep this meta tag for google search indexing
  meta_name("google-site-verification" = "2hjin2NTF-SVY6SAw-HRZcg1Z-q5iNEbwHOTW4yfIao") |> 
  meta_general(
    application_name = 'COVID-19 in the Urban Built Environment',
    description = description_text,
    robots = 'index',
    subject = "COVID-19 SARS-CoV-2 environmental microbiology epidemiology urban built environment Ontario",
    rating = "General"
  ) |>
  meta_social(
    title = "COVID-19 in the Urban Built Environment",
    url = "https://cube-ontario.github.io",
    image = "https://cube-ontario.github.io/figures/CUBE_info6.png",
    image_alt = description_text,
    og_type = "website",
    og_site_name = "COVID-19 in the Urban Built Environment",
    og_author = c("Lucas Castellani","Evgueni Doukhanine", "Michael Fralick", "Aaron Hinz", "Benazir Hodzic-Santor", "Rees Kassen", "Derek MacFadden", "Allison McGeer","Jason Moggridge", "Caroline Nott", "Ashley Raudanskis", "Nisha Thampi", "Tamara Van Bakel", "Alex Wong", "Veronica Zanichelli"),
    twitter_card_type = "summary_large_image",
    twitter_creator = "@quaxlikeaduck",
    twitter_site = "@quaxlikeaduck",
    # twitter_image = "https://cube-ontario.github.io/figures/CUBE_info6.png",
    disable_pinterest = TRUE
  )

```

```{r icons}
email_icon <- icons::icon_style(icons::fontawesome("paper-plane", style = "solid"), fill = '#2469e0', hover = '#fff')
```




<!-- ## About CUBE section-->
<div class='card' style='box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);'>

<!-- header -->
<div class='card-header'>
  <h4 style="margin: 5px; padding: 0px">About the CUBE study</h4>
</div>

<div class='card-body'>

<!-- *--infographic here--* -->
<img class='info' src="figures/CUBE_info6.png" alt="CUBE Study Info-graphic">

<!-- blurb -->
<p>
  <ul>
  <li>
  The COVID-19 in the Urban Built Environment (CUBE) project seeks to develop environmental sampling as a spatially-resolved method for monitoring COVID-19 in congregate settings such as long-term care homes (LTC), universities, public schools, and daycares. 
  </li>
  <li>
  We collect samples by swabbing floors; then, the swabs are tested for COVID-19 using an [RT-qPCR](https://en.wikipedia.org/wiki/Reverse_transcription_polymerase_chain_reaction) assay developed by [DNA Genotek](https://www.dnagenotek.com/) and/or a novel CRISPR-based device.
  </li>
  <li>
  Currently, we are focused on facilities located in Toronto, Ottawa, and Sault Ste. Marie.
  </li>
  <li>
  [Click here to read our preprint](https://www.medrxiv.org/content/10.1101/2021.04.09.21255159v2) from an earlier study showing the effectiveness of environmental sampling for COVID-19 monitoring.
  </li>
  </ul>
</p>

</div>
</div>

<br>
<br>


<!-- ## Map _ section -->
<!-- dynamic text with values based on the data in sites.tsv -->
  
<div class='card' style='box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);'>
  <!-- header -->
  <div class='card-header'>
  <h4 style="margin: 5px; padding: 0px">Study Locations</h4>
  </div>
  
  <!-- map description -->
  <div class='card-body'>
  Our research team is currently monitoring `r n_site` buildings in Toronto, Ottawa, and Sault Ste. Marie, including `r n_ltc` long-term care homes, `r n_dc` day-cares, and 6 university buildings. *Click any city to expand*.

  <!-- map -->
```{r maps, message=F, warning=FALSE, echo=F, fig.height=3, fig.width=3, fig.align='center'}
# display the map
ontario_map
```
  </div>
</div>

<br>
<br>

<!-- ## "Learn more" section --> 
<div class='card' style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
<!-- header -->
<div class='card-header bg-light mb-3'>
<h4 style="margin: 5px; padding: 0px">Learn more</h4>
</div>

<div class='card-body'>
<div class ='flex'>
<div class ='row'>


<div class ='col-12 col-md-4'>
<!-- lecture -->
<div class='card bg-light mb-3' style='height:100%'>
  <a href="https://www.cbc.ca/listen/live-radio/1-90-columnists-from-cbc-radio/clip/15896240-looking-covid-try-floor">
  <div class='card-header'><b>Looking for COVID? Try the floor</b></div>
  <div class='card-body'>
  <img src="pics/radio.png" alt="Looking for COVID? Try the floor - preview image">
  <p style="color: #2c3e50">The CBC interviews Rees Kassen about his article in The Conversation</p>
  </div> 
  </a>
</div>
</div>

<div class ='col-12 col-md-4'>
<!-- lecture -->
<div class='card bg-light mb-3' style='height:100%'>
  <a href="https://theconversation.com/swabbing-floors-to-detect-covid-19-could-be-a-useful-indicator-of-the-diseases-spread-175832">
  <div class='card-header'>
  <b>Swabbing floors to detect COVID-19 could be a useful indicator of the diseaseâ€™s spread</b>
  </div>
  <div class='card-body'>
  <img src="pics/convo_card_preview.jpeg" alt="'Wet floor' signs lying on a tile floor"> 
  <p style="color: #2c3e50">Aaron Hinz and Rees Kassen for <em>the Conversation</em></p>
  </div> 
  </a>
</div>
</div>

<div class ='col-12 col-md-4'>
<!-- lecture -->
<div class='card bg-light mb-3' style='height:100%'>
  <a href="https://www.loc.gov/item/webcast-9908/">
  <div class='card-header'><b>Library of congress lecture</b></div>
  <div class='card-body'>
  <img src="pics/loc_thumb2.jpg" alt="Library of Congress lecture preview image">
  <p style="color: #2c3e50">Presented by Rees Kassen and Caroline Nott</p>
  <i class="fas fa-play"></i>  &nbsp;&nbsp; <em>Skip to 44:10</em>
  </div> 
  </a>
</div>
</div>





</div>

<br>

<div class='row'>
<div class='col-12 col-md-4'>
<!-- CUBE @ Your Facility -->
<div class='card bg-light mb-3' style="height:100%; width: 100%">
  <div class='card-header'><h5>CUBE @ Your Facility</h5></div>
  <div class='card-body'>
  To arrange for CUBE testing in your facility, please contact us.
  <hr>
  <a class="btn btn-primary" href="contact.html" role="button">Contact us</a>
</div>
</div>
</div>

<div class='col-12 col-md-4'>
<!-- Contribute to CUBE -->
<div class='card bg-light mb-3' style="height:100%; width: 100%">
  <div class='card-header'><h5>Contribute to CUBE</h5></div>
  <div class='card-body'>
  If you are interested in contributing to the CUBE research project, please get in touch.
  <hr>
  <a class="btn btn-primary" href="contact.html" role="button">Contact us</a>
</div>
</div>

</div>
</div>

</div>
</div>
</div>

<br>
<br>





  

<!-- FAQs card -->

<!-- ## "Learn more" section --> 
<div class='card' style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
<!-- header -->
<div class='card-header'>
<h4 style="margin: 5px; padding: 0px">Frequently Asked Questions</h4>
</div>

<div class='card-body'>
<i>click to expand</i>
<div id="accordion">


```{r results='asis'}
# FAQs are stored in ./data/
x <- read_csv('data/FAQs.csv', col_types = cols()) |> 
  mutate(x = row_number()) |> 
  mutate(html = pmap(
    .l = list(question, answer, x), 
    .f = function(question, answer, x) {make_faq_bootstrap(question, answer, x)}
  ))
```

</div>
</div>
</div>

<br>
<br>


  <!-- Research team section /// style="background-color: white" -->
<div class='card'>
  <div class='card-header'><h4>Research Team </h4></div>
  <div class='card-body'>
  
```{r team_cards, results='asis'}
# use results='asis' for this chunk to return as raw html
# read profiles data and map to html; 
team <- read_tsv('data/team_profiles.tsv') |> 
  mutate(html = pmap(.l = list(name, path_to_pic, bio), 
                     .f = function(x,y,z) make_bio_bootstrap4(x, y, z)))
```
<br>
</div>
</div>
<br>

-----

<h5 style="text-align: center;">[Back to top](#) </h5>

----


<!-- use this line to prevent the floating TOC from adding tons of blank space to the bottom of the webpage -->
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>


<!-- to add the hero pic above the TOC: -->
<!-- javascript to insert a new div before the TOC in the TOC's parent -->
<script>
  $(document).ready(function() {
    $('#TOC').prepend('<a href=\"index.html\"><div id=\"nav_logo\"><img src=\"logo.jpg\"></div></a>');
  });
</script>
<style>
#nav_logo {
  width: 100%;
  padding: 1em;
  margin: 0.5em;
}
</style>
